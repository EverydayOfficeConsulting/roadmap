<script>
    const roadmapData = [
        {
            id: 1,
            phase: "Phase 0: Foundations (Setup)",
            title: "Business Bank Account",
            desc: "Open a dedicated business account and credit card. This is Step 1 for a clean audit trail.",
            videoUrl: "#", 
            toolUrl: "#",
            completed: false,
            canSkip: false
        },
        {
            id: 2,
            phase: "Phase 0: Foundations (Setup)",
            title: "Accounting Software (QBO)",
            desc: "Setup your QuickBooks Online account to act as your central financial hub.",
            videoUrl: "#", 
            toolUrl: "https://quickbooks.intuit.com/ca/",
            completed: false,
            canSkip: false
        },
        {
            id: 3,
            phase: "Phase 0: Foundations (Setup)",
            title: "Contractor Chart of Accounts",
            desc: "Import a specialized Chart of Accounts to track labor, materials, and overhead properly.",
            videoUrl: "#", 
            toolUrl: "#",
            completed: false,
            canSkip: false
        },
        {
            id: 4,
            phase: "Phase 0: Foundations (Setup)",
            title: "Company Profile & Settings",
            desc: "Input your logo, address, and fiscal year end into QBO settings.",
            videoUrl: "#", 
            toolUrl: "#",
            completed: false,
            canSkip: false
        },
        {
            id: 5,
            phase: "Phase 0: Foundations (Setup)",
            title: "Connect Bank Feeds",
            desc: "Link your business accounts so your transaction data imports automatically.",
            videoUrl: "#", 
            toolUrl: "#",
            completed: false,
            canSkip: false
        },
        {
            id: 6,
            phase: "Phase 1: Expansion (Milestones)",
            title: "Register for HST",
            desc: "Required once you hit $30k in sales. Includes getting your BN from the CRA.",
            videoUrl: "#", 
            toolUrl: "https://www.canada.ca/en/revenue-agency/services/tax/businesses/topics/gst-hst-businesses/register-a-gst-hst-account.html",
            completed: false,
            canSkip: true 
        },
        {
            id: 7,
            phase: "Phase 1: Expansion (Milestones)",
            title: "WCB Registration",
            desc: "Mandatory if you have employees or sub-contractors without their own coverage.",
            videoUrl: "#", 
            toolUrl: "https://www.wcb.ns.ca/", // Defaulted to NS since you're there
            completed: false,
            canSkip: true 
        },
        {
            id: 8,
            phase: "Phase 1: Expansion (Milestones)",
            title: "Payroll Registration",
            desc: "Get an RP account number from CRA to pay employees or yourself via salary.",
            videoUrl: "#", 
            toolUrl: "#",
            completed: false,
            canSkip: true
        },
        {
            id: 9,
            phase: "Phase 2: Organization",
            title: "Receipt Capture (Dext)",
            desc: "Setup Dext to digitize receipts and push them directly into QBO.",
            videoUrl: "#", 
            toolUrl: "https://dext.com/ca",
            completed: false,
            canSkip: false
        },
        {
            id: 10,
            phase: "Phase 3: Annual Maintenance",
            title: "Monthly Reconcile",
            desc: "Standard end-of-month check to ensure your bank and QBO match perfectly.",
            videoUrl: "#", 
            toolUrl: "https://tools.eoco.ca/newcalculator/",
            completed: false,
            canSkip: false
        }
    ];

    function renderRoadmap() {
        const root = document.getElementById('roadmap-root');
        root.innerHTML = '';
        let currentPhase = "";

        roadmapData.forEach(task => {
            if (task.phase !== currentPhase) {
                currentPhase = task.phase;
                const header = document.createElement('div');
                header.className = 'phase-header';
                header.innerText = currentPhase;
                root.appendChild(header);
            }

            const card = document.createElement('div');
            card.className = `task-card ${task.completed ? 'completed' : ''}`;
            card.innerHTML = `
                <div class="task-title">${task.completed ? '✅ ' : ''}${task.title}</div>
                <p class="task-desc">${task.desc}</p>
                
                <a href="${task.videoUrl}" class="video-btn">
                    ▶ Watch Tutorial
                </a>

                <div class="btn-row">
                    <button class="btn btn-outline" onclick="window.location.href='${task.toolUrl}'">Open Tool/Portal</button>
                    ${task.canSkip && !task.completed ? `<button class="btn btn-outline" style="border-color: #f39c12; color: #d35400;" onclick="completeTask(${task.id})">Skip for Now</button>` : ''}
                    <button class="btn btn-done" onclick="completeTask(${task.id})">
                        ${task.completed ? 'FINISHED' : 'MARK AS DONE'}
                    </button>
                </div>
            `;
            root.appendChild(card);
        });
        updateProgress();
    }

    function completeTask(id) {
        const idx = roadmapData.findIndex(t => t.id === id);
        if (idx !== -1) {
            roadmapData[idx].completed = true;
            renderRoadmap();
        }
    }

    function updateProgress() {
        const finished = roadmapData.filter(t => t.completed).length;
        const percent = Math.round((finished / roadmapData.length) * 100);
        document.getElementById('progress-bar').style.width = percent + '%';
        document.getElementById('progress-label').innerText = `Roadmap Progress: ${percent}%`;
    }

    renderRoadmap();
</script>
