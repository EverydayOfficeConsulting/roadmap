<script>
    // THE MASTER ROADMAP DATA
    const roadmapData = [
        {
            id: 1,
            phase: "Phase 0: Foundations (Setup)",
            title: "Business Bank Account",
            desc: "Open a dedicated business account and credit card. Essential for keeping personal and business finances separate.",
            videoUrl: "#", 
            toolUrl: "#",
            completed: false,
            canSkip: false
        },
        {
            id: 2,
            phase: "Phase 0: Foundations (Setup)",
            title: "Accounting Software (QBO)",
            desc: "Create your QuickBooks Online account. This will be the hub for all your financial data.",
            videoUrl: "#", 
            toolUrl: "https://quickbooks.intuit.com/ca/",
            completed: false,
            canSkip: false
        },
        {
            id: 3,
            phase: "Phase 0: Foundations (Setup)",
            title: "Contractor Chart of Accounts",
            desc: "Import or create a Chart of Accounts specifically designed for the trades to track project costs accurately.",
            videoUrl: "#", 
            toolUrl: "#",
            completed: false,
            canSkip: false
        },
        {
            id: 4,
            phase: "Phase 0: Foundations (Setup)",
            title: "Company Profile & Settings",
            desc: "Update your logo, address, and fiscal year end in the QBO settings menu.",
            videoUrl: "#", 
            toolUrl: "#",
            completed: false,
            canSkip: false
        },
        {
            id: 5,
            phase: "Phase 0: Foundations (Setup)",
            title: "Connect Bank Feeds",
            desc: "Link your business bank and credit card to QBO so transactions flow in automatically.",
            videoUrl: "#", 
            toolUrl: "#",
            completed: false,
            canSkip: false
        },
        {
            id: 6,
            phase: "Phase 1: Expansion (Milestones)",
            title: "Register for HST",
            desc: "MANDATORY if sales exceed $30k in 12 months. Includes getting your Business Number (BN) from the CRA.",
            videoUrl: "#", 
            toolUrl: "https://www.canada.ca/en/revenue-agency/services/tax/businesses/topics/gst-hst-businesses/register-a-gst-hst-account.html",
            completed: false,
            canSkip: true // Added 'Skip for now' logic
        },
        {
            id: 7,
            phase: "Phase 1: Expansion (Milestones)",
            title: "Payroll Registration",
            desc: "Register for a Payroll (RP) account with the CRA if you are hiring employees or paying yourself a salary.",
            videoUrl: "#", 
            toolUrl: "#",
            completed: false,
            canSkip: true
        },
        {
            id: 8,
            phase: "Phase 2: Organization",
            title: "Receipt Capture (Dext)",
            desc: "Connect Dext to your QBO account to automate receipt collection and stop the paper trail.",
            videoUrl: "#", 
            toolUrl: "https://dext.com/ca",
            completed: false,
            canSkip: false
        },
        {
            id: 9,
            phase: "Phase 3: Annual Maintenance",
            title: "Monthly Reconcile",
            desc: "Close out the month by matching all transactions and checking bank balances.",
            videoUrl: "#", 
            toolUrl: "https://tools.eoco.ca/newcalculator/",
            completed: false,
            canSkip: false
        }
    ];

    function renderRoadmap() {
        const root = document.getElementById('roadmap-root');
        root.innerHTML = '';
        let currentPhase = "";

        roadmapData.forEach(task => {
            if (task.phase !== currentPhase) {
                currentPhase = task.phase;
                const header = document.createElement('div');
                header.className = 'phase-header';
                header.innerText = currentPhase;
                root.appendChild(header);
            }

            const card = document.createElement('div');
            card.className = `task-card ${task.completed ? 'completed' : ''}`;
            card.innerHTML = `
                <div class="task-title">${task.completed ? '✅ ' : ''}${task.title}</div>
                <p class="task-desc">${task.desc}</p>
                
                <a href="${task.videoUrl}" class="video-btn">
                    ▶ Watch Tutorial
                </a>

                <div class="btn-row">
                    <button class="btn btn-outline" onclick="window.location.href='${task.toolUrl}'">Open Tool/Portal</button>
                    ${task.canSkip && !task.completed ? `<button class="btn btn-outline" style="border-color: #f39c12; color: #d35400;" onclick="skipTask(${task.id})">Skip for Now</button>` : ''}
                    <button class="btn btn-done" onclick="completeTask(${task.id})">
                        ${task.completed ? 'FINISHED' : 'MARK AS DONE'}
                    </button>
                </div>
            `;
            root.appendChild(card);
        });
        updateProgress();
    }

    function completeTask(id) {
        const idx = roadmapData.findIndex(t => t.id === id);
        if (idx !== -1) {
            roadmapData[idx].completed = true;
            renderRoadmap();
        }
    }

    function skipTask(id) {
        alert("This task has been moved to your 'Watch List'. Remember to return here once your business reaches the required milestone.");
        // Logic to hide or move task can be added here
    }

    function updateProgress() {
        const finished = roadmapData.filter(t => t.completed).length;
        const percent = Math.round((finished / roadmapData.length) * 100);
        document.getElementById('progress-bar').style.width = percent + '%';
        document.getElementById('progress-label').innerText = `Roadmap Progress: ${percent}%`;
    }

    renderRoadmap();
</script>
